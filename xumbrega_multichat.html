<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Xumbr3ga ‚Äî Multi Chat</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap');

*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;background:transparent;overflow:hidden;font-family:'Rajdhani',sans-serif;}

/* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
#panel{
  position:absolute;inset:0;
  display:flex;flex-direction:column;
  background:rgba(8,4,20,0.88);
  border:1px solid rgba(168,85,247,0.5);
  border-radius:8px;
  box-shadow:0 0 30px rgba(168,85,247,0.25),inset 0 0 20px rgba(168,85,247,0.03);
  overflow:hidden;
  backdrop-filter:blur(12px);
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
#hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px;flex-shrink:0;
  background:rgba(168,85,247,0.1);
  border-bottom:1px solid rgba(168,85,247,0.35);
}
.htitle{
  font-family:'Orbitron',monospace;font-size:11px;font-weight:900;
  color:#fff;letter-spacing:4px;text-shadow:0 0 10px rgba(168,85,247,0.7);
}
.plats{display:flex;gap:7px;align-items:center;}
.pb{
  font-family:'Orbitron',monospace;font-size:8px;font-weight:900;
  padding:3px 8px;border-radius:3px;letter-spacing:1px;
  opacity:0.28;transition:opacity .4s,box-shadow .4s;display:flex;align-items:center;gap:4px;
}
.pb.on{opacity:1;box-shadow:0 0 10px var(--g);}
.pb.tw{background:#9147ff;color:#fff;--g:rgba(145,71,255,0.7);}
.pb.yt{background:#cc0000;color:#fff;--g:rgba(204,0,0,0.7);}
.pb.ki{background:#53fc18;color:#000;--g:rgba(83,252,24,0.7);}
.pb svg{width:9px;height:9px;flex-shrink:0;}

/* ‚îÄ‚îÄ VIEWERS ‚îÄ‚îÄ */
#viewers{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:5px 12px;
  background:rgba(168,85,247,0.12);
  border:1px solid rgba(168,85,247,0.4);
  border-radius:6px;
  white-space:nowrap;
  box-shadow:0 0 10px rgba(168,85,247,0.15);
  line-height:1;gap:3px;
}
#viewers .vlabel{
  font-family:'Orbitron',monospace;font-size:7px;font-weight:700;
  color:rgba(192,132,252,0.7);letter-spacing:2px;
}
#viewer-count{
  font-family:'Orbitron',monospace;font-size:15px;font-weight:900;
  color:#fff;letter-spacing:1px;
  text-shadow:0 0 12px rgba(192,132,252,0.8);
}

/* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
#msgs{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:8px 10px;display:flex;flex-direction:column;gap:6px;
}
#msgs::-webkit-scrollbar{width:3px;}
#msgs::-webkit-scrollbar-thumb{background:rgba(168,85,247,0.4);border-radius:2px;}

.msg{
  display:flex;flex-direction:column;gap:3px;padding:8px 10px;
  background:rgba(168,85,247,0.06);border-left:3px solid var(--bc,#a855f7);
  border-radius:0 6px 6px 0;animation:mIn .28s ease;word-break:break-word;flex-shrink:0;
}
@keyframes mIn{from{opacity:0;transform:translateX(-8px);}to{opacity:1;transform:translateX(0);}}
.msg-top{display:flex;align-items:center;gap:6px;}
.mbadge{
  font-family:'Orbitron',monospace;font-size:10px;font-weight:900;
  padding:2px 6px;border-radius:2px;flex-shrink:0;letter-spacing:.5px;display:flex;align-items:center;gap:3px;
}
.mbadge svg{width:8px;height:8px;}
.mbadge.tw{background:#9147ff;color:#fff;}
.mbadge.yt{background:#cc0000;color:#fff;}
.mbadge.ki{background:#53fc18;color:#000;}
.muser{font-family:'Orbitron',monospace;font-size:13px;font-weight:900;letter-spacing:1px;}
.mtext{font-size:18px;font-weight:400;color:rgba(220,210,240,0.95);line-height:1.4;padding-left:1px;}
.mtext img{height:1.2em;vertical-align:middle;margin:0 1px;}
.msys{
  text-align:center;font-family:'Orbitron',monospace;font-size:8px;
  color:rgba(192,132,252,0.75);letter-spacing:2px;
  padding:5px 8px;border:1px solid rgba(168,85,247,0.25);border-radius:4px;
  background:rgba(88,28,135,0.15);animation:mIn .28s ease;flex-shrink:0;
}
</style>
</head>
<body>

<div id="panel">
  <div id="hdr">
    <span class="htitle">XUMBR3GA</span>
    <div class="plats">
      <span id="st-tw" class="pb tw" title="Twitch">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>
        TW
      </span>
      <span id="st-yt" class="pb yt" title="YouTube">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.495 6.205a3.007 3.007 0 00-2.088-2.088c-1.87-.501-9.396-.501-9.396-.501s-7.507-.01-9.396.501A3.007 3.007 0 00.527 6.205a31.247 31.247 0 00-.522 5.805 31.247 31.247 0 00.522 5.783 3.007 3.007 0 002.088 2.088c1.868.502 9.396.502 9.396.502s7.506 0 9.396-.502a3.007 3.007 0 002.088-2.088 31.247 31.247 0 00.5-5.783 31.247 31.247 0 00-.5-5.805zM9.609 15.601V8.408l6.264 3.602z"/></svg>
        YT
      </span>
      <span id="st-ki" class="pb ki" title="Kick">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 3h3v7l6.5-7H17l-7 7 7.5 11H14L8 13.5V21H4z"/></svg>
        KI
      </span>
    </div>
    <div id="viewers">
      <span class="vlabel">üëÅ VIEWERS</span>
      <span id="viewer-count">‚Äî</span>
    </div>
  </div>
  <div id="msgs"></div>
</div>

<script>
const MAX = 60;
const BC  = { tw: '#a855f7', yt: '#ff6b6b', ki: '#53fc18' };
const SVG = {
  tw: `<svg viewBox="0 0 24 24" fill="currentColor" style="width:8px;height:8px"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>`,
  yt: `<svg viewBox="0 0 24 24" fill="currentColor" style="width:8px;height:8px"><path d="M23.495 6.205a3.007 3.007 0 00-2.088-2.088c-1.87-.501-9.396-.501-9.396-.501s-7.507-.01-9.396.501A3.007 3.007 0 00.527 6.205a31.247 31.247 0 00-.522 5.805 31.247 31.247 0 00.522 5.783 3.007 3.007 0 002.088 2.088c1.868.502 9.396.502 9.396.502s7.506 0 9.396-.502a3.007 3.007 0 002.088-2.088 31.247 31.247 0 00.5-5.783 31.247 31.247 0 00-.5-5.805zM9.609 15.601V8.408l6.264 3.602z"/></svg>`,
  ki: `<svg viewBox="0 0 24 24" fill="currentColor" style="width:8px;height:8px"><path d="M4 3h3v7l6.5-7H17l-7 7 7.5 11H14L8 13.5V21H4z"/></svg>`
};

function esc(s) {
  return String(s ?? '')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function boostColor(hex) {
  if (!hex || !/^#[0-9a-f]{6}$/i.test(hex)) return null;
  let r = parseInt(hex.slice(1,3),16)/255;
  let g = parseInt(hex.slice(3,5),16)/255;
  let b = parseInt(hex.slice(5,7),16)/255;
  const max = Math.max(r,g,b), min = Math.min(r,g,b);
  let h = 0, s = 0, l = (max+min)/2;
  if (max !== min) {
    const d = max-min;
    s = l > 0.5 ? d/(2-max-min) : d/(max+min);
    switch(max) {
      case r: h = (g-b)/d + (g<b?6:0); break;
      case g: h = (b-r)/d + 2; break;
      case b: h = (r-g)/d + 4; break;
    }
    h /= 6;
  }
  l = Math.max(l, 0.70);
  s = Math.max(s, 0.55);
  function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;}
  const q = l<0.5 ? l*(1+s) : l+s-l*s, p = 2*l-q;
  r = Math.round(hue2rgb(p,q,h+1/3)*255);
  g = Math.round(hue2rgb(p,q,h)*255);
  b = Math.round(hue2rgb(p,q,h-1/3)*255);
  return `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;
}

function setOn(p, v) { document.getElementById('st-' + p)?.classList.toggle('on', !!v); }

function sys(text) {
  const d = document.createElement('div');
  d.className = 'msys'; d.textContent = text; push(d);
}

function addMsg({ p, user, color, html }) {
  if (!html?.trim()) return;
  const d = document.createElement('div');
  d.className = 'msg';
  d.style.setProperty('--bc', BC[p]);
  const raw = (color && /^#[0-9a-f]{6}$/i.test(color)) ? color : BC[p];
  const uc  = boostColor(raw) || BC[p];
  d.innerHTML =
    `<div class="msg-top">` +
      `<span class="mbadge ${p}">${SVG[p]}${p.toUpperCase()}</span>` +
      `<span class="muser" style="color:${uc};text-shadow:0 0 10px ${uc}88,0 0 2px ${uc}44">${esc(user)}</span>` +
    `</div>` +
    `<div class="mtext">${html}</div>`;
  push(d);
}

function push(el) {
  const c = document.getElementById('msgs');
  const atBot = c.scrollHeight - c.scrollTop - c.clientHeight < 80;
  c.appendChild(el);
  while (c.children.length > MAX) c.removeChild(c.firstChild);
  if (atBot) c.scrollTop = c.scrollHeight;
}

window.addEventListener('load', () => {
  const es = new EventSource('/events?history=1');
  es.onmessage = ({ data }) => {
    const msg = JSON.parse(data);
    if (msg.p === 'status')  { setOn(msg.platform, msg.on); return; }
    if (msg.p === 'sys')     { sys(msg.text); return; }
    if (msg.p === 'viewers') {
      document.getElementById('viewer-count').textContent = msg.total.toLocaleString();
      return;
    }
    addMsg(msg);
  };
  es.onerror = () => sys('‚ö†Ô∏è Conex√£o com servidor perdida...');
});
</script>
</body>
</html>
